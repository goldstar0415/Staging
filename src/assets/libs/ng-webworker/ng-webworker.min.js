/**
 * ng-webworker - ng-webworker creates dynamic webworkers so angular apps can be multi-threaded.
 * @version v0.2.3
 * @link https://github.com/mattslocum/ng-webworker
 * @license MIT
 */
!function(e,r,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):r[e]=n()}("ngWebworker",this,function(){"use strict";var e=angular.module("ngWebworker",[]),r="function",n="return",t="complete",o="notice";return e.provider("Webworker",function(){function e(e){function s(e,r){var n=function(){};r.external||!r.useHelper?this.oWorker=new Worker(e):(this.oWorker=new Worker(i.helperPath),this.strWorkerFunc=e),this.config=angular.extend({onMessage:n,onError:n,onReturn:n,onComplete:n,onNotice:n},r),r.onmessage&&(this.config.onMessage=r.onmessage,this.config.onError=r.onerror)}function a(e,r){var n=[];return r.config.transferOwnership&&!r.config.useHelper&&angular.forEach(e,function(e){e instanceof ArrayBuffer&&n.push(e)}),n}function complete(e){postMessage(["complete",e],_transferable_(e))}function notify(e){postMessage(["notice",e])}this.create=function(e,t){function _transferable_(e){var r=[];return"[object Array]"!=Object.prototype.toString.apply(e)&&(e=[e]),e.forEach(function(e){e instanceof ArrayBuffer&&r.push(e)}),r}var o,a,u,l,c=window,f=c.URL||c.webkitURL;if(t=t||{},t=angular.extend(angular.copy(i),t),(-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Edge")||navigator.appVersion.indexOf("Trident/")>0)&&(t.useHelper=!0),Worker&&f&&f.createObjectURL&&(Blob||c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder))if(typeof e==r){t.external=!1,t.useHelper||(o=/function\s*(\w*)(.*)/.exec(e.toString()),o[1]=o[1]||"a",a="function "+o[1]+o[2],a+=e.toString().substring(o[0].length),a+=";onmessage=function(e){;var result = "+o[1]+".apply(null,e.data);postMessage(['"+n+"', result], !_async_ ? _transferable_(result) : [])};",a+="var _async_ = "+t.async+";"+_transferable_.toString(),c.Blob?u=new Blob([complete,notify,a],{type:"application/javascript"}):(c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder)&&(c.BlobBuilder=c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder,u=new BlobBuilder,u.append(complete),u.append(notify),u.append(a),u=u.getBlob()));try{t.useHelper?(o=/function\s*(\w*)(.*)/.exec(e.toString()),o[1]=o[1]||"a",a="function "+o[1]+o[2],a+=e.toString().substring(o[0].length),l=new s(a,t)):l=new s(f.createObjectURL(u),t)}catch(p){}}else t.external=!0,l=new s(e,t);return l},s.prototype.run=function(){var r,i=e.defer(),s=this;return this.oWorker.onmessage=function(e){var r,a=e.data;s.config.external&&!s.config.async?i.resolve(a):(r=e.data.shift(),a=e.data[0],s.config.onMessage(e),r!=t&&r!=n&&i.notify(a),r==n?(s.config.async||i.resolve(a),s.config.onReturn(a)):r==t?(i.resolve(a),s.config.onComplete(a)):r==o&&s.config.onNotice(a))},this.oWorker.onerror=function(e){i.reject(e)},r=s.config.external||!s.config.useHelper?Array.prototype.slice.call(arguments):{fn:s.strWorkerFunc,args:Array.prototype.slice.call(arguments)},this.oWorker.postMessage(r,a(r,this)),s.config.external||s.config.useHelper||i.promise["finally"](function(){s.terminate()}),i.promise},s.prototype.stop=function(){this.oWorker.onerror(new Error("stopped")),this.terminate()},s.prototype.terminate=function(){this.oWorker.terminate()}}var i={async:!1,helperPath:"worker_wrapper.js",useHelper:!1,transferOwnership:!0};this.setConfig=function(e){angular.extend(i,e)},this.setHelperPath=function(e){i.helperPath=e},this.setUseHelper=function(e){i.useHelper=!!e},this.setTransferOwnership=function(e){i.transferOwnership=!!e},this.$get=["$q",function(r){return new e(r)}]}),e});