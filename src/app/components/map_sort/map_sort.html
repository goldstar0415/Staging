<user-hints></user-hints>
<!-- ng-show="$root.mapSortSpots.sourceSpots.length || !MapSort.vertical" -->
<div class="map-toggle-menu" ng-click="MapSort.vertical = !MapSort.vertical; MapSort.openedItem = null" ng-show="$root.mapSortSpots.sourceSpots.length || !MapSort.vertical" class="new-sidebar-menu" ng-class="!MapSort.vertical ? 'map-toggle-menu-opened' : ''">
    <span class="glyphicon" ng-class="MapSort.vertical ? 'glyphicon-menu-up' : 'glyphicon-menu-down'"></span>
</div>
<!-- <div ng-show="MapSort.vertical && ($root.$state.current.name == 'index' || $root.$state.current.name == 'areas.preview')" class="new-sidebar-menu"> -->
<div class="new-sidebar-menu" ng-class="!MapSort.vertical ? 'new-sidebar-menu-opened' : ''" ng-show="$root.$state.current.name == 'index' || $root.$state.current.name == 'areas.preview'">
    <!-- <div class="show-menu-profile visible-xs" ng-class="$root.mapSortSpots.sourceSpots.length ? 'blink' : ''" ng-click="MapSort.vertical = !MapSort.vertical"></div> -->

    <div class="sidebar-menu-vertical" ng-class="$root.$state.current.name == 'index' ? 'sidebar-menu-vertical-bottom' : ''">
        <ul>
            <li ng-click="$root.toggleLayer('event')" ng-class="{'active': $root.sortLayer == 'event'}" class="event-sidebar">
                <img src="../../../assets/img/svg/Icon_Events.svg" alt="img">
                <p>Events</p>
            </li>
            <li ng-click="$root.toggleLayer('todo')" ng-class="{'active': $root.sortLayer == 'todo'}" class="todo-sidebar">
                <img src="../../../assets/img/svg/Icon_To_do.svg" alt="img">
                <p>To-Do</p>
            </li>
            <li ng-click="$root.toggleLayer('food')" ng-class="{'active': $root.sortLayer == 'food'}" class="food-sidebar">
                <img src="../../../assets/img/svg/Icon_Grab_Grub.svg" alt="img">
                <p>Food</p>
            </li>
            <li ng-click="$root.toggleLayer('shelter')" ng-class="{'active': $root.sortLayer == 'shelter'}" class="shelter-sidebar">
                <img src="../../../assets/img/svg/Icon_Get_a_room.svg" alt="img">
                <p>Shelter</p>
            </li>
            <li ng-click="$root.toggleLayer('weather')" ng-class="{'active': $root.sortLayer == 'weather'}" class="weather-sidebar">
                <img src="../../../assets/img/svg/Icon_Weather.svg" alt="img">
                <p>Weather</p>
            </li>
        </ul>
    </div>
</div>

<div ng-show="!MapSort.vertical" class="col-xs-3 no-pad sort-menu">






    <!--Attention! HERE ADD CLASS "applied"-->
    <div class="search-filters col-xs-12" ng-show="$root.sortLayer != 'weather'" ng-class="{'applied-filter': !MapSort.isShowFilter && !MapSort.isEmptyFilters()}">
        <!--ADD CLASS "applied" here and styles will change-->
        <div class="row">
            <div class="col-xs-12 new-search" ng-show="!MapSort.isShowFilter" ng-if="false">
                <div class="country-filter" ng-hide="$root.isDrawArea">
                    <input type="text" role="search" placeholder="LOCATION OR SPOT NAME" ng-model="MapSort.searchParams.search_text" ng-model-options="{debounce: 200}" typeahead="address.formatted_address for address in MapSort.searchParams.typeahead.list" typeahead-on-select="MapSort.typeaheadSelectLocation($item)"
                        typeahead-wait-ms="100" ng-change="MapSort.typeaheadSearch()">
                    <span class="icon-nav"></span>
                </div>
                <!-- <div class="filters-button" id="filters-button-open" ng-click="MapSort.isShowFilter = !MapSort.isShowFilter"></div> -->
                <div class="btn-apply btn-top" ng-click="MapSort.search()" ng-show="!MapSort.isShowFilter && !$root.isDrawArea && MapSort.isEmptyFilters()">
                    <!-- <span class="icon-apply"></span> -->
                    SEARCH
                </div>
                <div class="btn-apply btn-top" id="btn-cancel" ng-click="MapSort.clearFilters()" ng-show="!MapSort.isShowFilter && !MapSort.isEmptyFilters()">
                    <!-- <span class="icon-cancel"></span> -->
                    CANCEL
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12" style="position:relative">











                <!--New filter-->
                <div class="new-filter" ng-show="MapSort.isShowFilter">
                    <!-- <form action=""> -->
                    <div class="filter-header">
                        <p>Filters</p>
                        <span class="glyphicon glyphicon-remove" ng-click="MapSort.isShowFilter = false"></span>
                    </div>
                    <div class="form-group">
                        <label for="filterRating">Minimum Rating</label>
                        <div class="filter-group">
                            <select class="form-control" id="filterRating">
                                <option value="1">★</option>
                                <option value="2">★★</option>
                                <option value="3">★★★</option>
                                <option value="4">★★★★</option>
                                <option value="5">★★★★★</option>
                            </select>
                            <button class="filter-clear"><p>Clear</p><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="filterCategory">Category</label>
                        <div class="filter-group">
                            <select class="form-control" id="filterCategory" placeholder="SELECT">
                                <option value="1">SELECT</option>
                                <!-- <option value="2">★★</option>
                                <option value="3">★★★</option>
                                <option value="4">★★★★</option>
                                <option value="5">★★★★★</option> -->
                            </select>
                            <button class="filter-clear"><p>Clear</p><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="filterTags">By tags & Keywords</label>
                        <div class="filter-group">
                            <!-- <input type="text" id="filterTags" value="tag,keyword" data-role="tagsinput"> -->
                            <input type="text" value="Amsterdam,Washington,Sydney,Beijing,Cairo" data-role="tagsinput">
                            <button class="filter-clear"><p>Clear</p><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>By dates</label>
                        <div class="filter-group">
                            <div class="date-filters clearfix" ng-class="{'move-top': $root.isDrawArea, applied: ($root.mapSortFilters.filter.start_date || $root.mapSortFilters.filter.end_date)}">
                                <input ng-datepicker ng-model="MapSort.searchParams.start_date" class="date" placeholder="FROM DATE" type="text" ng-disabled="!MapSort.isShowFilter">
                                <input ng-datepicker ng-model="MapSort.searchParams.end_date" start-date="MapSort.searchParams.start_date" class="date" placeholder="TO DATE" type="text" ng-disabled="!MapSort.isShowFilter">
                            </div>
                            <button class="filter-clear"><p>Clear</p><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="filter-group">
                            <input type="text" placeholder="HOTEL FEATURES">
                            <button class="filter-clear"><p>Clear</p><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                    </div>
                    <button class="filter-apply">APPLY FILTER</button>
                    <!-- </form> -->
                </div>







                <!--Filter-->
                <div class="filter-definition" ng-class="{'open-filter': MapSort.isShowFilter}" ng-show="false">

                    <div class="destination-filter clearfix" ng-show="MapSort.isShowFilter && !$root.isDrawArea">
                        <location address="MapSort.searchParams.address" location="MapSort.searchParams.location" input-placeholder="Add first destination" id="new_location" bind-marker="false" limit="15"></location>
                        <span class="icon-navpoint"></span>
                        <a ng-click="MapSort.addLocation()" class="clearfix"><span class="icon-plus"></span></a>
                    </div>
                    <div class="destination-filter clearfix" ng-show="MapSort.isShowFilter && !$root.isDrawArea" ng-repeat="item in MapSort.searchParams.locations">
                        <location address="item.address" location="item.location" input-placeholder="Add next destination" bind-marker="false" limit="15"></location>
                        <span class="icon-navpoint"></span>
                        <a ng-click="MapSort.removeLocation($index)" class="clearfix"><span class="icon-minus"></span></a>
                    </div>

                    <div class="date-filters clearfix" ng-show="(MapSort.isShowFilter || $root.mapSortFilters.filter.start_date || $root.mapSortFilters.filter.end_date) && $root.sortLayer == 'event'" ng-class="{'move-top': $root.isDrawArea, applied: ($root.mapSortFilters.filter.start_date || $root.mapSortFilters.filter.end_date)}">
                        <div class="form-group">
                            <span class="icon-calendar"></span>
                            <input ng-datepicker ng-model="MapSort.searchParams.start_date" class="date" placeholder="FROM DATE" type="text" ng-disabled="!MapSort.isShowFilter">
                        </div>
                        <div class="form-group">
                            <span class="icon-calendar"></span>
                            <input ng-datepicker ng-model="MapSort.searchParams.end_date" start-date="MapSort.searchParams.start_date" class="date" placeholder="TO DATE" type="text" ng-disabled="!MapSort.isShowFilter">
                        </div>
                        <a ng-click="MapSort.removeFilter('date')" ng-show="$root.mapSortFilters.filter.start_date || $root.mapSortFilters.filter.end_date" class="clearfix">
                            <span class="icon-minus"></span>
                        </a>
                    </div>

                    <div class="keyword-filters clearfix" ng-show="MapSort.isShowFilter || ($root.mapSortFilters.filter.tags.length && MapSort.searchParams.tags.length)" ng-class="{applied: !MapSort.isShowFilter}">
                        <div class="mt0">
                            <tags-input class="tags-input-custom" ng-model="MapSort.searchParams.tags" on-tag-adding="MapSort.onTagsAdd()" max-length="64" placeholder="Filter by keyword" on-invalid-tag="MapSort.invalidTag($tag)"></tags-input>
                        </div>
                        <span class="icon-key" ng-show="MapSort.searchParams.tags.length == 0"></span>
                        <a ng-click="MapSort.removeFilter('tags')" ng-show="!MapSort.isShowFilter && $root.mapSortFilters.filter.tags.length && MapSort.searchParams.tags.length" class="tags-minus clearfix">
                            <span class="icon-minus"></span>
                        </a>
                    </div>

                    <div class="rating-filters clearfix" ng-show="MapSort.isShowFilter || $root.mapSortFilters.filter.rating" ng-class="{applied: $root.mapSortFilters.filter.rating}">
                        <ui-select ng-model="MapSort.searchParams.rating" ng-disabled="!MapSort.isShowFilter" search-enabled="false" theme="bootstrap">
                            <ui-select-match class="star-rated" placeholder="star rating">
                                Rated Higher than {{ $select.selected }} Stars
                            </ui-select-match>
                            <ui-select-choices repeat="item in [4,3,2]">
                                <div ng-bind-html="'Rated Higher than ' + item + ' Stars'"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="icon-star"></span>
                        <a ng-click="MapSort.removeFilter('rating')" ng-show="$root.mapSortFilters.filter.rating" class="clearfix">
                            <span class="icon-minus"></span>
                        </a>
                    </div>

                    <div class="category-filter clearfix relative" ng-show="MapSort.isShowFilter">
                        <div class=" clearfix">
                            <button type="button" class="category-dropdown" ng-click="MapSort.categoryToggle = !MapSort.categoryToggle">
                                <span> Filter by categories</span>

                                <span class="icon-category"></span>
                                <span class="filters-arrow" ng-click="MapSort.categoryToggle = !MapSort.categoryToggle"
                                    ng-class="{'open-arrow': MapSort.categoryToggle}"></span>
                            </button>

                            <div class="categories">
                                <div ng-show="MapSort.categoryToggle" class="hide-block-subcategory form-group">
                                    <ul class="list-unstyled">
                                        <li ng-click="MapSort.selectAllCategories()">
                                            <a>Select all sub-categories</a>
                                            <span class="icon-selected"></span>
                                        </li>
                                        <li ng-repeat="item in MapSort.spotCategories[$root.sortLayer]" ng-click="item.selected = !item.selected">
                                            <a ng-class="{'active': item.selected}">{{item.display_name}}</a>
                                            <span class="icon-selected"></span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-show="MapSort.isShowFilter" class="btn-apply" ng-click="MapSort.search()">APPLY FILTER</div>

                    <div class="destination-filter applied" ng-show="!MapSort.isShowFilter" ng-repeat="item in MapSort.spotCategories[$root.sortLayer] | filter:{selected: true}">
                        <input type="text" role="search" ng-model="item.display_name" disabled/>
                        <a ng-click="MapSort.removeFilterCategory(item)" class="clearfix"><span class="icon-minus"></span></a>
                    </div>

                </div>



                <!-- Opened item -->
                <div ng-if="MapSort.openedItem != null">
                    <spot spot="MapSort.openedItem" small="true"></spot>
                </div>



                <!--Search results-->
                <div class="mobile-view" ng-if="MapSort.openedItem == null">
                    <p class="mobile-spots">{{$root.mapSortSpots.sourceSpots.length || 0}} {{ $root.sortLayer }} Spots found</p>
                    <p class="mobile-filter" ng-click="MapSort.isShowFilter = !MapSort.isShowFilter">
                        <span class="glyphicon glyphicon-filter"> </span>
                         Filter
                    </p>
                    <div class="mobile-line"></div>
                </div>
                <div class="location" ng-if="MapSort.openedItem == null && false">
                    <span class="glyphicon glyphicon-record"></span>
                    <p>{{MapSort.location}}</p>
                </div>
                <div class="new-result" ng-if="MapSort.openedItem == null">
                    <div infinite-scroll="MapSort.loadNextSpots()" infinite-scroll-disabled="$root.mapSortSpots.isLoading || !$root.mapSortSpots.data.length || MapSort.vertical" class="clearfix" infinite-scroll-distance="1" infinite-scroll-container='".search-filters"'>
                        <div ng-repeat="item in $root.mapSortSpots.data" class="new-spot">
                            <!-- <p>{{item}}</p> -->
                            <div class="spot-img">
                                <div class="img" ng-click="MapSort.setOpenedItem(item)">
                                    <img src="{{item.cover_url.original}}" alt="spot_img">
                                </div>
                                <div class="spot-img-top">
                                    <p>{{item.category.display_name}}</p>
                                    <!-- <span class="glyphicon glyphicon-heart"></span> -->
                                    <a ng-if="$root.currentUser.id != item.user_id && !item.is_favorite" class="glyphicon glyphicon-heart" ng-click="MapSort.addToFavorite(item)" style="color:white"></a>
                                    <a ng-if="$root.currentUser && $root.currentUser.id != item.user_id && item.is_favorite" class="glyphicon glyphicon-heart" ng-click="MapSort.removeFromFavorite(item)" style="color:#EE4632"></a>
                                </div>
                                <div class="spot-img-bottom">
                                    <stars item="item"></stars>
                                    <!-- <p>? reviews</p> -->
                                    <!-- <span class="glyphicon glyphicon-fullscreen" ng-click="MapSort.setOpenedItem(item)"></span> -->
                                </div>
                            </div>
                            <p class="spot-name">{{item.title}}</p>
                            <p class="spot-address">
                                <p>
                                    <span class="glyphicon glyphicon-map-marker"></span>
                                    <span>{{item.points[0].address}}</span>
                                </p>
                            </p>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>


    <div class="footer-search" ng-class="{'active-weather': $root.sortLayer == 'weather'}">


        <div ng-show="$root.sortLayer == 'weather'">
            <div ng-show="MapSort.currentWeather" class="weather-wrap">
                <div class="firstBlock-wrapper col-xs-12">
                    <p class="right-now">Currently in {{ MapSort.currentWeatherLocation.placeName }}</p>

                    <p class="weatherName">{{MapSort.currentWeather.summary}}</p>

                    <div class="weatherImg-block">
                        <!-- <p class="weatherData">{{MapSort.currentWeather.formattedDate}}</p> -->
                        <div class="temperature-block">
                            <span class="temperature-text">Clear Feels like {{MapSort.currentWeather.temperatureMin| number:0}}</span><span class="unit">°F</span>
                            <!-- <p class="unit2"><span>H</span>{{MapSort.currentWeather.temperatureMax | number:0}}° </p>
 <p class="unit2"><span>L</span>{{MapSort.currentWeather.temperatureMin | number:0}}°</p> -->
                        </div>
                        <div class="weatherImg-wrapper">
                            <div class="weatherImg" ng-class="MapSort.currentWeather.icon"></div>
                            <span class="temperature-img">{{MapSort.currentWeather.temperature}}°F</span>
                        </div>
                        <div class="row weather-parameters">
                            <div class="col-md-3 col-xs-3 text-center">
                                <p class="mainParameters">{{MapSort.currentWeather.sunrise}}</p>

                                <p class="description">sunrise</p>
                            </div>
                            <div class="col-md-3 col-xs-3 text-center">
                                <p class="mainParameters">{{MapSort.currentWeather.sunset}}</p>

                                <p class="description">sunset</p>
                            </div>
                            <div class="col-md-3 col-xs-3 text-center">
                                <p class="mainParameters">{{MapSort.currentWeather.windSpeed | number:0}} <span>km/h</span></p>

                                <p class="description">wind</p>
                            </div>
                            <div class="col-md-3 col-xs-3 text-center">
                                <p class="mainParameters">{{(MapSort.currentWeather.humidity * 100) | number:0 }} <span>%</span></p>

                                <p class="description">humidity</p>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="parameters">
                        <div>
                        <p class="mainParameters">{{MapSort.currentWeather.sunrise}}</p>

                        <p class="description">sunrise</p>
                        </div>
                        <div>
                        <p class="mainParameters">{{MapSort.currentWeather.sunset}}</p>

                        <p class="description">sunset</p>
                        </div>
                        <div>
                        <p class="mainParameters">{{MapSort.currentWeather.windSpeed | number:0}} <span>km/h</span></p>

                        <p class="description">wind</p>
                        </div>
                        <div>
                        <p class="mainParameters">{{MapSort.currentWeather.humidity * 100}} <span>%</span></p>

                        <p class="description">humidity</p>
                        </div>
                        </div> -->
            </div>
                <div class="wrapperHr">
                    <hr/>
                </div>
                <div class="weekForecast col-xs-12">
                    <div class="col-xs-12 no-pad weekForecast-inner">
                        <div class="weekForecast-wrapper">
                            <span class="data">Today</span>

                            <div class="weatherIcon">
                                <div ng-class="MapSort.currentWeather.icon"></div>
                            </div>
                            <div class="weather-summary col-xs-12">{{MapSort.currentWeather.summary}}</div>
                        </div>
                        <div class="wrapperHr">
                            <hr/>
                        </div>
                    </div>
                    <div ng-repeat="item in MapSort.weatherForecast track by $index" class="col-xs-12 no-pad weekForecast-inner">
                        <div class="weekForecast-wrapper">
                            <span class="data">{{item.formattedDate}}</span>

                            <div class="weatherIcon">
                                <div ng-class="item.icon"></div>
                            </div>
                            <div class="weather-summary col-xs-12">{{item.summary}}</div>
                            <span class="temperatureWeek">{{item.temperatureMax| number:0}}°F <br>{{item.temperatureMin| number:0}}°F </span>
                        </div>
                        <div class="wrapperHr">
                            <hr/>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-show="!MapSort.currentWeather" class="col-xs-12 weather-info">
                <p>Click on map to check weather in this area</p>
            </div>
        </div>
    </div>
    <!-- <a class="close-popup" ng-click="MapSort.vertical = !MapSort.vertical"></a> -->
</div>
